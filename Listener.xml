<Ui xmlns="http://www.blizzard.com/wow/ui/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.blizzard.com/wow/ui/ ..\..\FrameXML\UI.xsd">
  <Frame name="ListenerFrame" parent="UIParent" enableMouse="false" movable="true" resizable="true" hidden="false" frameStrata="BACKGROUND">
    <Size x="300" y="200"/>
		<ResizeBounds>
			<minResize>
				<AbsDimension x="200" y="100"/>
			</minResize>
		</ResizeBounds>
    <Anchors>
      <Anchor point="CENTER"><Offset x="0" y="0"/></Anchor>
    </Anchors>
    
    <Layers>
      <Layer level="BACKGROUND">
        <Texture parentKey="bg" setallpoints="true">
          <Color b="0.0" r="0.0" g="0.0" a="0.25"/>
        </Texture>
      </Layer>
    </Layers>
    
    <!--
    <Backdrop bgFile="Interface\ChatFrame\ChatFrameBackground" tile="true">
      <TileSize val="16"/>
      <EdgeSize val="16"/>
      <BackgroundInsets left="4" right="4" top="4" bottom="4"/>
      <Color b="0.0" r="0.0" g="0.0" a="0.25"/>
    </Backdrop>-->
    <Scripts>
      <OnLoad>
        self:EnableMouse( false )
        self:SetClampedToScreen( true )
        ListenerAddon.Frame_SetupEdge( self )
      </OnLoad>
      <OnEnter>
        ListenerAddon.Frame_OnEnter(self)
      </OnEnter>
      <OnLeave>
        ListenerAddon.Frame_OnLeave(self)
      </OnLeave>
      <OnMouseDown>
        ListenerAddon.Frame_OnMouseDown( self, button ) 
      </OnMouseDown>
      <OnMouseUp>
        ListenerAddon.Frame_OnMouseUp( self, button )
      </OnMouseUp>
      
    </Scripts>
    <Frames>
    
      <!-- Bar -->
      
      <Frame name="$parentBar" enableMouse="false" frameStrata="LOW">
        <Anchors>
          <Anchor point="TOPLEFT"><Offset x="0" y="3"/></Anchor>
          <Anchor point="BOTTOMRIGHT" relativePoint="TOPRIGHT"><Offset x="0" y="-11"/></Anchor>
        </Anchors>  
        
        <Frames>
          <!-- Buttons -->
          <ListenerFrameButton name="$parentToggle">
            <Anchors>
              <Anchor point="CENTER" relativePoint="TOPLEFT"><Offset x="12" y="0"/></Anchor>
            </Anchors>
            <Scripts>
              <OnLoad>
                self:RegisterForClicks( "LeftButtonDown", "RightButtonDown" )
                self:SetColor( 0.5, 1.0, 0.5 )
              </OnLoad>
              <OnClick>
                ListenerAddon:TogglePlayerClicked( button )
              </OnClick> 
            </Scripts>
          </ListenerFrameButton>
          
          <ListenerFrameButton name="$parentShowSay">
            <Anchors>
              <Anchor point="CENTER" relativePoint="TOPLEFT"><Offset x="30" y="0"/></Anchor>
            </Anchors>
            <Scripts>
              <OnLoad> 
                self:SetColor( 1, 1, 1 )
              </OnLoad>
              <OnClick>
                ListenerAddon:ToggleSay()
              </OnClick>
            </Scripts>
          </ListenerFrameButton>
          
          <ListenerFrameButton name="$parentShowParty"> 
            <Anchors>
              <Anchor point="CENTER" relativePoint="TOPLEFT"><Offset x="48" y="0"/></Anchor>
            </Anchors> 
            <Scripts>
              <OnLoad> 
                self:SetColor( 0.05, 0.2, 1 )
              </OnLoad>
              <OnClick>
                ListenerAddon:ToggleParty()
              </OnClick>
            </Scripts>
          </ListenerFrameButton>
          
          <ListenerFrameButton name="$parentRead"> 
            <Anchors>
              <Anchor point="CENTER" relativePoint="TOPLEFT"><Offset x="66" y="0"/></Anchor>
            </Anchors> 
            <Scripts>
              <OnLoad> 
                self:SetColor( 0.95, 0.90, 0.13 )
              </OnLoad>
              <OnClick>
                ListenerAddon:MarkAllRead()
              </OnClick>
            </Scripts>
          </ListenerFrameButton>
        </Frames>
      </Frame>
      
      <Frame name="$parentScrollmark" hidden="true">
        <Anchors>
          <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT"><Offset x="1" y="3"/></Anchor>
          <Anchor point="BOTTOMRIGHT" relativePoint="BOTTOMRIGHT"><Offset x="-1" y="1"/></Anchor>
        </Anchors>
        <Layers>
          <Layer setAllPoints="true">
            <Texture parentKey="tex">
              
              <Color r="1.0" g="1.0" b="1.0" a="0.25" />
            </Texture>
          </Layer>
        </Layers>
        <Scripts>
          <OnUpdate>
                    
            if ListenerAddon:HasUnreadEntries() then
              -- flash red if we have new entries
              local a = math.sin(GetTime() * 3) * 0.4 + 0.6
              self.tex:SetColorTexture( 1, 0.21, 0.04, a )
            else
              self.tex:SetColorTexture( 1, 1, 1, 0.25 )
            end
            
          </OnUpdate>
        </Scripts>
      </Frame>
      
      <Button name="$parentResizeButton" parentKey="resizeButton" hidden="true">
        
				<Size x="12" y="12"/>
        <Anchors>
          <Anchor point="BOTTOMRIGHT" x="-1" y="1"/>
        </Anchors>
				<Scripts>
					<OnMouseDown>
            ListenerAddon.FrameResizeButton_OnMouseDown( self, button )
            
					</OnMouseDown>
					<OnMouseUp>
            ListenerAddon.FrameResizeButton_OnMouseUp( self, button )
            
					</OnMouseUp>
          <OnLeave>
            ListenerAddon.FrameResizeButton_OnLeave( self )
          </OnLeave>
				</Scripts>
				<NormalTexture file="Interface\ChatFrame\UI-ChatIM-SizeGrabber-Up"/>
				<HighlightTexture file="Interface\ChatFrame\UI-ChatIM-SizeGrabber-Highlight"/>
				<PushedTexture file="Interface\ChatFrame\UI-ChatIM-SizeGrabber-Down"/>
      </Button>
      
      <ScrollingMessageFrame name="$parentChat" parentKey="chatbox" maxlines="500" displayduration="300" nonspacewrap="true">
        <Anchors>
          <Anchor point="TOPLEFT" x="2" y="-6"/>
          <Anchor point="BOTTOMRIGHT" x="-2" y="3"/>
        </Anchors>
				<Scripts>
          <OnLoad>
            self:SetClipsChildren( true )
            self:SetJustifyH( "LEFT" )
            self:EnableMouseWheel( true )
            self:SetHyperlinksEnabled( true )
            self:SetIndentedWordWrap( true )
             
            hooksecurefunc( self, "RefreshDisplay", function()
            
            --self:SetScript( "OnMessageScrollChanged", function( self ) 
              -- show or hide the scroll marker if we are scrolled up
              if self:GetScrollOffset() ~= 0 then
                ListenerFrameScrollmark:Show()
              else
                ListenerFrameScrollmark:Hide()
              end
              
              ListenerAddon:SetClickBlock()
              ListenerAddon:UpdateHighlight()
            end)
            self:SetFading( false )
            
          </OnLoad>
          <OnMouseWheel>
            ListenerAddon:OnChatboxScroll( delta )
          </OnMouseWheel>
          <OnHyperlinkClick>
            ListenerAddon:OnChatboxHyperlinkClick( link, text, button )
          </OnHyperlinkClick>
          
          <OnMessageScrollChanged>
            -- doesn't work?
          </OnMessageScrollChanged>
          
        </Scripts>
      </ScrollingMessageFrame>
      
      
      
    </Frames>
  </Frame>
</Ui>








